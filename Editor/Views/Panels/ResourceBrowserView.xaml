<UserControl x:Class="FirstEngineEditor.Views.Panels.ResourceBrowserView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:sys="clr-namespace:System;assembly=mscorlib"
             xmlns:converters="clr-namespace:FirstEngineEditor.Converters"
             mc:Ignorable="d"
             AllowDrop="True"
             Drop="OnDrop"
             DragOver="OnDragOver">
    <UserControl.Resources>
        <!-- Converters -->
        <converters:StringToVisibilityConverter x:Key="StringToVisibilityConverter"/>
        <converters:InverseStringToVisibilityConverter x:Key="InverseStringToVisibilityConverter"/>
    </UserControl.Resources>
    <Grid Background="#FF2D2D30">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Toolbar -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Background="DarkGray" Margin="5">
            <Button Content="ðŸ“" Width="30" ToolTip="Import Resource" Click="OnImportResource"/>
            <Button Content="âž•" Width="30" ToolTip="Create Resource" Click="OnCreateResource"/>
            <Button Content="â†»" Width="30" ToolTip="Refresh" Click="OnRefresh" Margin="5,0,0,0"/>
            <Separator Margin="10,0"/>
            <ComboBox x:Name="TypeFilterComboBox" Width="120" Margin="5,0,0,0"
                      SelectionChanged="OnTypeFilterChanged">
                <ComboBoxItem Content="All Types" IsSelected="True"/>
                <ComboBoxItem Content="Texture"/>
                <ComboBoxItem Content="Model"/>
                <ComboBoxItem Content="Mesh"/>
                <ComboBoxItem Content="Material"/>
                <ComboBoxItem Content="Scene"/>
                <ComboBoxItem Content="Shader"/>
            </ComboBox>
            <TextBox x:Name="SearchTextBox" Width="200" Margin="10,0,0,0" 
                     TextChanged="OnSearchTextChanged">
                <TextBox.Style>
                    <Style TargetType="TextBox">
                        <Style.Triggers>
                            <Trigger Property="Text" Value="">
                                <Setter Property="Foreground" Value="Gray"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </TextBox.Style>
            </TextBox>
        </StackPanel>

        <!-- Breadcrumb Navigation -->
        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="5,2" x:Name="BreadcrumbPanel">
            <Button Content="ðŸ“¦ Package" Click="OnNavigateToRoot">
                <Button.Style>
                    <Style TargetType="Button">
                        <Setter Property="Background" Value="Transparent"/>
                        <Setter Property="Foreground" Value="#FF0078D4"/>
                        <Setter Property="BorderThickness" Value="0"/>
                        <Setter Property="Padding" Value="5,2"/>
                        <Setter Property="Margin" Value="2,0"/>
                        <Setter Property="Cursor" Value="Hand"/>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Foreground" Value="#FF1C97EA"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>
        </StackPanel>

        <!-- Resource Browser Content -->
        <Grid Grid.Row="2" Margin="5">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="200"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Folder Tree -->
            <TreeView Grid.Column="0" x:Name="FolderTreeView" 
                      SelectedItemChanged="OnFolderSelected"
                      ItemsSource="{Binding Folders}"
                      Background="#FF252526"
                      Foreground="White">
                <TreeView.ItemTemplate>
                    <HierarchicalDataTemplate ItemsSource="{Binding Children}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ“" Margin="0,0,5,0"/>
                            <TextBlock Text="{Binding Name}"/>
                        </StackPanel>
                    </HierarchicalDataTemplate>
                </TreeView.ItemTemplate>
            </TreeView>

            <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Stretch" Background="Gray"/>

            <!-- Resource Grid -->
            <ScrollViewer Grid.Column="2" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                <ItemsControl x:Name="ResourceItemsControl" ItemsSource="{Binding FilteredResources}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel Orientation="Horizontal"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Width="120" Height="140" Margin="5" 
                                Background="#FF3F3F46" 
                                BorderBrush="Gray" 
                                BorderThickness="1"
                                Cursor="Hand"
                                MouseLeftButtonDown="OnResourceItemClicked"
                                ToolTip="{Binding VirtualPath}">
                                <StackPanel VerticalAlignment="Center" Margin="5">
                                    <!-- Thumbnail -->
                                    <Border Width="100" Height="100" Background="Black" Margin="0,0,0,5">
                                        <Grid>
                                            <Image Source="{Binding ThumbnailPath}" 
                                                   Stretch="Uniform"
                                                   HorizontalAlignment="Center"
                                                   VerticalAlignment="Center"
                                                   Visibility="{Binding ThumbnailPath, Converter={StaticResource StringToVisibilityConverter}}"/>
                                            <!-- Fallback icon if no thumbnail -->
                                            <TextBlock Text="{Binding TypeIcon}" 
                                                       FontSize="40"
                                                       HorizontalAlignment="Center"
                                                       VerticalAlignment="Center"
                                                       Foreground="Gray"
                                                       Visibility="{Binding ThumbnailPath, Converter={StaticResource InverseStringToVisibilityConverter}}"/>
                                        </Grid>
                                    </Border>
                                    <!-- Resource Name -->
                                    <TextBlock Text="{Binding Name}" 
                                               TextWrapping="Wrap"
                                               TextAlignment="Center"
                                               Foreground="White"
                                               FontSize="10"
                                               MaxHeight="30"/>
                                </StackPanel>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
        </Grid>
    </Grid>
</UserControl>
